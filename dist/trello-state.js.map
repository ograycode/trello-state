{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 58315ab407b3cbe70d4a","webpack:///./src/trello-state.js"],"names":["on","cards","time","state","forEach","clone","JSON","parse","stringify","card","actions","Date","action","date","data","old","key","filter","length","push","cycleTime","startingLists","endingLists","start","end","list","last","findLast","earliest","findEarliest","Math","abs","getTime","listId","isListBefore","type","listBefore","id","listAfter"],"mappings":"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","file":"trello-state.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"trelloState\"] = factory();\n\telse\n\t\troot[\"trelloState\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 58315ab407b3cbe70d4a\n **/","export default {\n  on (cards, time) {\n    const state = [];\n    cards.forEach(card => {\n      const clone = JSON.parse(JSON.stringify(card));\n      clone.actions.forEach(action => {\n        if (time < new Date(Date.parse(action.date)) && action.data.old) {\n          for (const key in action.data.old) {\n            clone[key] = action.data.old[key];\n          }\n        }\n      });\n      clone.actions = clone.actions.filter(action => {\n        return time > new Date(Date.parse(action.date))\n      });\n      if (clone.actions.length > 0) {\n        state.push(clone);\n      }\n    });\n    return state;\n  },\n  cycleTime(card, startingLists, endingLists) {\n    let start, end;\n    startingLists.forEach((list) => {\n      const last = this.findLast(card, list);\n      if ((!start && last) || (last > start)) {\n        start = last;\n      }\n    });\n    \n    endingLists.forEach((list) => {\n      const earliest = this.findEarliest(card, list);\n      if ((!end && earliest) || (earliest < end)) {\n        end = earliest;\n      }\n    });\n    \n    if (!start || !end) {\n      return -1;\n    }\n    return Math.abs(start.getTime() - end.getTime());\n  },\n  findEarliest(card, listId) {\n    let earliest;\n    let isListBefore = false;\n    card.actions.forEach((action) => {\n      const date = new Date(Date.parse(action.date));\n      if (action.type === 'createCard' && isListBefore) {\n        isListBefore = false;\n        earliest = date;\n      } else if (action.type === 'updateCard') {\n        if (action.data.listBefore && action.data.listBefore.id === listId) {\n          //need to find the next action that changed it, or created event.\n          isListBefore = true;\n        } else if (action.data.listAfter && action.data.listAfter.id === listId) {\n          if (!earliest || earliest > date) {\n            earliest = date;\n          }\n        }\n      }\n    });\n    return earliest;\n  },\n  findLast(card, listId) {\n    let last;\n    let isListBefore = false;\n    card.actions.forEach((action) => {\n      const date = new Date(Date.parse(action.date));\n      if (action.type === 'createCard' && isListBefore) {\n        isListBefore = false;\n        if (!last || last < date) {\n          last = date;\n        }\n      } else if (action.type === 'updateCard') {\n        if (action.data.listAfter && action.data.listAfter.id === listId) {\n          if (!last || last < date) {\n            last = date;\n          }\n          isListBefore = false;\n        } else if (action.data.listBefore.id === listId) {\n          // need to find either the last after event or created event.\n          isListBefore = true;\n        }\n      }\n    });\n    return last;\n  }\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/trello-state.js\n **/"],"sourceRoot":""}